matrix:
  include:
    - language: php
      php: 7.0
      install:
        - composer install --prefer-dist
      script:
        - vendor/bin/phpunit

    - language: php
      php: 7.1
      install:
        - composer install --prefer-dist
      script:
        - vendor/bin/phpunit

    - language: php
      php: 7.2
      install:
        - composer install --prefer-dist
      script:
        - vendor/bin/phpunit

    - language: node_js
      node_js: 6.11
      cache:
        - ~/.lando
        - ~/.cache
      before_install:
        - sudo apt-get -y update
        - sudo apt-get -y install cgroup-bin curl
        - curl -fsSL -o /tmp/lando-latest.deb https://github.com/lando/lando/releases/download/v3.0.0-beta.47/lando-v3.0.0-beta.47.deb
        - sudo dpkg -i /tmp/lando-latest.deb
        - lando version
      install:
        - lando start
        - lando install
        - yarn install --frozen-lockfile
        - cypress install
      script:
        - cypress run --config 'baseUrl=http://conifer.lndo.site'
      after_failure:
        - curl --upload-file ./cypress/videos/conifer.spec.js.mp4 https://transfer.sh/conifer.spec.js.mp4

  allow_failures:
    - language: node_js

